{% extends 'poolservice/base.html' %}
{% load poolservicetags %}

{% block js %}
    <!-- GoogleChartjs CDN -->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
      google.charts.load('current', {'packages':['corechart']});
      google.charts.setOnLoadCallback(drawChart);

      function drawChart() {
        var data = google.visualization.arrayToDataTable([

          ['–î–∞—Ç–∞', 'Ph'],
          {% for d in logs %}
          ['{{d.time|date:"jMY"}}', {% get_dot d.PH %}],
          {% endfor %}

        ]);

        var options = {

          title: '–£—Ä–æ–≤–µ–Ω—å Ph',
          curveType: 'function',
          legend: { position: 'top' },
          colors:['green','#004411'],
          pointSize: '5',

        };

        var chart = new google.visualization.LineChart(document.getElementById('curve_chart1'));

        chart.draw(data, options);
      }
    </script>

    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
      google.charts.load('current', {'packages':['corechart']});
      google.charts.setOnLoadCallback(drawChart);

      function drawChart() {
        var data = google.visualization.arrayToDataTable([

          ['–î–∞—Ç–∞', 'Cl'],
          {% for d in logs %}
          ['{{d.time|date:"jMY"}}', {% get_dot d.CL %}],
          {% endfor %}

        ]);

        var options = {
          title: '–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ —Ö–ª–æ—Ä–∞',
          curveType: 'function',
          legend: { position: 'top' },
          pointSize: '5',
        };

        var chart = new google.visualization.LineChart(document.getElementById('curve_chart2'));

        chart.draw(data, options);
      }
    </script>

    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
      google.charts.load('current', {'packages':['corechart']});
      google.charts.setOnLoadCallback(drawChart);

      function drawChart() {
        var data = google.visualization.arrayToDataTable([

          ['–î–∞—Ç–∞', 'Redox'],
          {% for d in logs %}
          ['{{d.time|date:"jMY"}}', {% get_dot d.RX %}],
          {% endfor %}

        ]);

        var options = {
          title: '–û–∫–∏—Å–ª–∏—Ç–µ–ª—å–Ω–æ-–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ–ª—å–Ω—ã–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª',
          curveType: 'function',
          legend: { position: 'top' },
          colors:['yellow'],
          pointSize: '5',
        };

        var chart = new google.visualization.LineChart(document.getElementById('curve_chart3'));

        chart.draw(data, options);
      }
    </script>

    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
      google.charts.load('current', {'packages':['corechart']});
      google.charts.setOnLoadCallback(drawChart);

      function drawChart() {
        var data = google.visualization.arrayToDataTable([

          ['–î–∞—Ç–∞', '–¢¬∞C'],
          {% for d in logs %}
          ['{{d.time|date:"jMY"}}', {% get_dot d.T %}],
          {% endfor %}

        ]);

        var options = {
          title: '–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤–æ–¥—ã',
          curveType: 'function',
          legend: { position: 'top' },
          colors:['red','#004411'],
          pointSize: '5',
        };

        var chart = new google.visualization.LineChart(document.getElementById('curve_chart4'));

        chart.draw(data, options);
      }
    </script>
{% endblock js %}

{% block title %}
{{title}}
{% endblock title %}

{% block body %}
<div class="container">
<h1>{{pool.title}}</h1>
{% if pool.photo %}
<img src="{{pool.photo.url}}" height="200" width="350">
{% endif %}<br>
    {% if pool.volume %}
        <span class="badge bg-light-subtle text-light-emphasis rounded-pill">–û–±—ä–µ–º:</span>
    <p>üßä {{pool.volume}} –∫—É–±.–º.</p>
    {% endif %}
    {% if pool.place %}
        <span class="badge bg-light-subtle text-light-emphasis rounded-pill">–ú–µ—Å—Ç–æ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è:</span><br>
    <p>üöö {{pool.place|linebreaksbr}}</p>
    {% endif %}
    {% if pool.equipment %}
        <span class="badge bg-light-subtle text-light-emphasis rounded-pill">–ö–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—è:</span><br>
        <p>üõ†Ô∏è {{pool.equipment|linebreaksbr}}</p>
    {% endif %}
    {% if pool.description %}
        <span class="badge bg-light-subtle text-light-emphasis rounded-pill">–û–ø–∏—Å–∞–Ω–∏–µ:</span><br>
        <p>üìã {{pool.description|linebreaksbr}}</p>
    {% endif %}
    {% if pool.year_create %}
    <span class="badge bg-light-subtle text-light-emphasis rounded-pill">–ì–æ–¥ –ø–æ—Å—Ç—Ä–æ–π–∫–∏:</span>
            <p>üìÜ {{pool.year_create}} –≥.</p>
    {% endif %}
    <span class="badge bg-light-subtle text-light-emphasis rounded-pill">–ö–æ–Ω—Ç–∞–∫—Ç—ã:</span><br>
            {% if pool.owner %}
            <p>üßëüèª‚Äç {{pool.owner}}</p>
            {% endif %}
            {% if pool.phone %}
            <p>‚òéÔ∏è {{pool.phone}}</p>
            {% endif %}
            {% if pool.email %}
            <p>üìß <a href="mailto:{{pool.email}}">{{pool.email}}</a></p>
            {% endif %}
    {% if 'new_log' in request.META.HTTP_REFERER %}
                <span class="badge bg-primary-subtle text-primary-emphasis rounded-pill"><a href="{% url 'home' %}" class="nav-link">–ù–∞–∑–∞–¥</a></span>
                {% elif 'pool_logs' in request.META.HTTP_REFERER %}
                <span class="badge bg-primary-subtle text-primary-emphasis rounded-pill"><a onclick="javascript:history.back();" href="#"  class="nav-link">–ù–∞–∑–∞–¥</a></span>
                {% else %}
                <span class="badge bg-primary-subtle text-primary-emphasis rounded-pill"><a  href="{% url 'home' %}" class="nav-link">–ù–∞–∑–∞–¥</a></span>
    {% endif %}
    {% if request.user == pool.author  or request.user.is_superuser %}
                <span class="badge bg-warning-subtle text-warning-emphasis rounded-pill"><a href="{% url 'pool_update' pool.slug %}" class="nav-link">–ò–∑–º–µ–Ω–∏—Ç—å</a></span>
                <span class="badge bg-danger-subtle text-danger-emphasis rounded-pill"><a href="{% url 'pool_delete' pool.id %}" class="nav-link">–£–¥–∞–ª–∏—Ç—å</a></span>
    {% endif %}
</div>
<br>
<div class="container">
    <h4>–¢–∞–±–ª–∏—Ü–∞ —Å–µ—Ä–≤–∏—Å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –ø–æ –±–∞—Å—Å–µ–π–Ω—É {{pool.title}}</h4>
    <table class="table table-striped">
      <thead>
        <tr>
          <th scope="col">–î–∞—Ç–∞</th>
          <th scope="col">Ph</th>
          <th scope="col">Cl/Rx</th>
          <th scope="col">–¢¬∞C</th>
          <th scope="col">–†–µ–∞–≥–µ–Ω—Ç—ã</th>
        </tr>
      </thead>
        <tbody>
        {% for l in logs %}
        <tr>
            <td>
                <a class="nav-link" href="{% url 'log' pk=l.pk%}">üîç {% if l.works %} üõ†Ô∏è {% endif %}
                    {% if l.comment %}üí¨ {% endif %}</a>
                <small>{{ l.time_create|date:"jMY"}}</small>
            </td>
            <td>{% if l.PH %}{{ l.PH }}{% endif %}</td>
            <td>{% if l.CL %}{{ l.CL }}<br>{% endif %}{% if l.RX %}{{ l.RX }}{% endif %}</td>
            <td>{% if l.T %}{{ l.T }}{% endif %}</td>
            <td><small>{{l.reagents|linebreaksbr}}</small></td>
        </tr>
        {% endfor %}
        </tbody>
    </table>

{% comment %}
<div class="row mt-3 pt-3">

        <div class="col-md-8">
            <div>
                <canvas id="myChart" ></canvas>
            </div>

            <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
            <script>
              const ctx = document.getElementById('myChart');

              new Chart(ctx, {
                data: {
                  labels: [{% for d in logs %} '{{d.time_create|date:"jM"}}',{% endfor %}],
                  datasets: [{
                    type: 'line',
                    label: 'PH',
                    data: [{% for d in logs %} {% get_dot d.PH %},{% endfor %}],
                    fill: true,
                    borderColor: 'rgb(75, 192, 0)',
                    backgroundColor: 'rgba(75, 192, 0, 0.3)',
                    tension: 0.2,
                    order: 2,
                  },
                   {
                    type: 'line',
                    label: 'Cl',
                    data: [{% for d in logs %} {% get_dot d.CL %},{% endfor %}],
                    fill: true,
                    borderColor: 'rgb(255, 0, 0)',
                    backgroundColor: 'rgba(255, 0, 0, 0.3)',
                    tension: 0.2,
                    order: 1,
                  },
                    ]
                },
                options: {
                  scales: {
                    y: {
                      beginAtZero: false,
                    },
                  }
                }
              });
            </script>

        </div>
</div>
{% endcomment %}

    <div class="container">
        <div class="col-md-8">
            <div id="curve_chart1" style="height: 300px;"></div>
        </div>
        {% if show_cl %}
        <div class="col-md-8">
            <div id="curve_chart2" style="height: 300px;"></div>
        </div>
        {% endif %}

        {% if show_rx %}
        <div class="col-md-8">
            <div id="curve_chart3" style="height: 300px;"></div>
        </div>
        {% endif %}

        {% if show_t %}
        <div class="col-md-8">
            <div id="curve_chart4" style="height: 300px;"></div>
        </div>
        {% endif %}

    </div>

</div>
{% endblock body %}